= Multi Thread Http Server - Step3

* Queue를 이용한 대기열 구현
* Thread는 2개를 생성해서 처리

== Main.java

[source, java]
----
public static void main( String[] args ) throws IOException {
    try(ServerSocket serverSocket = new ServerSocket(8080);){

        HttpRequestHandler httpRequestHandlerA = new HttpRequestHandler();
        HttpRequestHandler httpRequestHandlerB = new HttpRequestHandler();

        Thread threadA = new Thread(httpRequestHandlerA);
        threadA.start();

        Thread threadB = new Thread(httpRequestHandlerB);
        threadB.start();


        long count = 0;

        while(true){
            Socket client = serverSocket.accept();

            if(count%2==0){
                httpRequestHandlerA.addRequest(client);
            }else{
                httpRequestHandlerB.addRequest(client);
            }
            count++;
        }
    }
}
----

== Queue 구현

* SIZE 10인 requestQueue 구현

[source, java]
----
private final Queue<Socket> requestQueue;
private final int MAX_QUEUE_SIZE=10;


public synchronized void addRequest(Socket client){
//TODO queueSize >= MAX_QUEUE_SIZE 대기 합니다. 즉 queue에 데에티거 소비될 때 까지 client Socket을 Queue에 등록하는 작업을 대기 합니다.

    while(requestQueue.size()>=MAX_QUEUE_SIZE){
        try {
            wait();
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
    }
    requestQueue.add(client);
    notifyAll();
}

public synchronized Socket getRequest(){
    //Queue가 비어있다면 대기 합니다.
    while(requestQueue.isEmpty()){
        try {
            wait();
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
    }
    notifyAll();
    return requestQueue.poll();
}
----


== HttpRequest Abstraction
* link:../src/main/java/com/nhnacademy/http/request/HttpRequestImpl.java[HttpRequestImpl]  구현 합니다.

[source,java]
--
include::../src/main/java/com/nhnacademy/http/request/HttpRequest.java[]
--

== HttpResponse Abstraction
* link:../src/main/java/com/nhnacademy/http/response/HttpResponseImpl.java[HttpResponseImpl] 구현 합니다.

[source, java]
--
include::../src/main/java/com/nhnacademy/http/response/HttpResponse.java[]
--

== Reference
* https://developer.mozilla.org/ko/docs/Web/HTTP/Methods[HTTP Methods]